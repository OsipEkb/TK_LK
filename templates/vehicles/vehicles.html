{% extends 'base.html' %}

{% block page_title %}–ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¢–°{% endblock %}

{% block body_class %}vehicles-container{% endblock %}

{% block content %}
<div class="vehicles-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="vehicles-header mb-4">
        <div class="header-glow"></div>
        <div class="container-fluid header-content">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <div class="d-flex align-items-center">
                        <div class="header-icon-wrapper me-4">
                            <i class="fas fa-chart-network fa-2x text-gold"></i>
                        </div>
                        <div>
                            <h1 class="h1 mb-2 fw-bold text-light">–ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¢–°</h1>
                            <div class="d-flex align-items-center gap-3">
                                <span class="badge bg-gold text-dark">
                                    <i class="fas fa-plug me-1"></i> AutoGRAPH –ê–∫—Ç–∏–≤–Ω–æ
                                </span>
                                <span class="text-light opacity-75">
                                    <i class="fas fa-user me-1"></i> {{ autograph_username|default:"–°–∏—Å—Ç–µ–º–∞" }}
                                </span>
                                <span class="text-light opacity-75">
                                    <i class="fas fa-database me-1"></i> {{ schema_name|default:"AutoGRAPH" }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 text-end">
                    <button class="btn btn-gold" onclick="analyzer.loadData()">
                        <i class="fas fa-sync-alt me-2"></i>–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid py-4">
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="info-panel">
                    <div class="info-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="info-content">
                        <strong>–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö:</strong> –°–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å—ã—Ä—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ AutoGRAPH.
                        –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞–±–æ—Ç—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤.
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="col-lg-3">
                <!-- –í—ã–±–æ—Ä –¢–° -->
                <div class="control-panel mb-4">
                    <div class="panel-header">
                        <h5 class="panel-title">
                            <i class="fas fa-car"></i>
                            –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞
                            <span class="badge bg-gold text-dark ms-2" id="selectedCount">0</span>
                        </h5>
                        <div class="input-group input-group-sm mt-2">
                            <span class="input-group-text bg-dark border-secondary text-light">
                                <i class="fas fa-search"></i>
                            </span>
                            <input type="text" class="form-control bg-dark border-secondary text-light"
                                   placeholder="–ü–æ–∏—Å–∫ –¢–°..." id="vehicleSearch"
                                   onkeyup="analyzer.searchVehicles(this.value)">
                        </div>
                    </div>
                    <div class="panel-body" style="height: 300px; overflow-y: auto;">
                        <div class="btn-group w-100 mb-3">
                            <button class="btn btn-dark-custom flex-grow-1" onclick="analyzer.selectAllVehicles()">
                                <i class="fas fa-check-double me-1"></i> –í—Å–µ
                            </button>
                            <button class="btn btn-dark-custom flex-grow-1" onclick="analyzer.deselectAllVehicles()">
                                <i class="fas fa-times me-1"></i> –°–±—Ä–æ—Å–∏—Ç—å
                            </button>
                        </div>

                        <div class="vehicles-list" id="vehiclesList">
                            <div class="text-center py-5">
                                <div class="spinner-border text-gold" role="status">
                                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                </div>
                                <p class="text-muted mt-3 mb-0">–ó–∞–≥—Ä—É–∑–∫–∞ –¢–°...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞ -->
                <div class="control-panel mb-4">
                    <div class="panel-header">
                        <h5 class="panel-title">
                            <i class="fas fa-calendar-alt"></i>
                            –ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞
                        </h5>
                    </div>
                    <div class="panel-body">
                        <div class="mb-3">
                            <label class="form-label text-light">–ù–∞—á–∞–ª–æ</label>
                            <input type="date" class="form-control bg-dark border-secondary text-light"
                                   id="dateFrom" value="{{ default_start_date }}">
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-light">–û–∫–æ–Ω—á–∞–Ω–∏–µ</label>
                            <input type="date" class="form-control bg-dark border-secondary text-light"
                                   id="dateTo" value="{{ default_end_date }}">
                        </div>

                        <div class="btn-group w-100 mb-3">
                            <button class="btn btn-dark-custom flex-grow-1" onclick="analyzer.setPeriod(1)">–î–µ–Ω—å</button>
                            <button class="btn btn-dark-custom flex-grow-1" onclick="analyzer.setPeriod(7)">–ù–µ–¥–µ–ª—è</button>
                            <button class="btn btn-dark-custom flex-grow-1" onclick="analyzer.setPeriod(30)">–ú–µ—Å—è—Ü</button>
                        </div>

                        <button class="btn btn-gold w-100" id="loadDataBtn" onclick="analyzer.loadData()" disabled>
                            <i class="fas fa-database me-2"></i>
                            –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                        </button>
                    </div>
                </div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö -->
                <div class="control-panel">
                    <div class="panel-header">
                        <h5 class="panel-title">
                            <i class="fas fa-chart-bar"></i>
                            –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                        </h5>
                    </div>
                    <div class="panel-body">
                        <div class="stats-item">
                            <div class="stats-label">–ó–∞–ø–∏—Å–µ–π:</div>
                            <div class="stats-value" id="statsRecords">0</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-label">–ü–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:</div>
                            <div class="stats-value" id="statsParams">0</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-label">–¢–° –≤ –¥–∞–Ω–Ω—ã—Ö:</div>
                            <div class="stats-value" id="statsVehicles">0</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-label">–ü–µ—Ä–∏–æ–¥:</div>
                            <div class="stats-value" id="statsPeriod">‚Äî</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="col-lg-9">
                <!-- –í–∫–ª–∞–¥–∫–∏ -->
                <div class="tabs-container mb-4">
                    <div class="tabs-header">
                        <button class="tab-btn active" data-tab="rawdata">
                            <i class="fas fa-database me-2"></i> –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
                        </button>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∞ –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ -->
                    <div class="tab-content active" id="rawdataTab">
                        <div class="raw-data-container">
                            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                            <div class="row mb-4">
                                <div class="col-md-12">
                                    <div class="info-panel info-small">
                                        <div class="info-content">
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <small class="text-muted">–ü—Ä–æ–±–µ–≥ (–∫–º):</small>
                                                    <div id="rawDataDistance">0</div>
                                                </div>
                                                <div class="col-md-3">
                                                    <small class="text-muted">–†–∞—Å—Ö–æ–¥ (–ª):</small>
                                                    <div id="rawDataFuel">0</div>
                                                </div>
                                                <div class="col-md-3">
                                                    <small class="text-muted">–°–∫–æ—Ä–æ—Å—Ç—å (–∫–º/—á):</small>
                                                    <div id="rawDataSpeed">0</div>
                                                </div>
                                                <div class="col-md-3">
                                                    <small class="text-muted">–†–µ–π—Ç–∏–Ω–≥ (%):</small>
                                                    <div id="rawDataRating">0</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ -->
                            <div class="row mb-4">
                                <div class="col-md-12">
                                    <div class="card bg-dark border-secondary">
                                        <div class="card-header">
                                            <h5 class="mb-0">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="mb-3">
                                                        <label class="form-label text-light">–¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞:</label>
                                                        <select class="form-control bg-dark border-secondary text-light" id="chartTypeSelect">
                                                            <option value="line">–õ–∏–Ω–µ–π–Ω—ã–π</option>
                                                            <option value="bar">–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã</option>
                                                            <option value="barHorizontal">–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã</option>
                                                            <option value="area">–û–±–ª–∞—Å—Ç–Ω–æ–π</option>
                                                            <option value="pie">–ö—Ä—É–≥–æ–≤–æ–π</option>
                                                            <option value="doughnut">–ö–æ–ª—å—Ü–µ–≤–æ–π</option>
                                                            <option value="radar">–†–∞–¥–∞—Ä–Ω—ã–π</option>
                                                            <option value="scatter">–¢–æ—á–µ—á–Ω—ã–π</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="mb-3">
                                                        <label class="form-label text-light">–†–∞–∑–º–µ—Ä –≥—Ä–∞—Ñ–∏–∫–∞:</label>
                                                        <select class="form-control bg-dark border-secondary text-light" id="chartSizeSelect">
                                                            <option value="small">–£–∑–∫–∏–π</option>
                                                            <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π</option>
                                                            <option value="large">–®–∏—Ä–æ–∫–∏–π</option>
                                                            <option value="full">–ü–æ–ª–Ω—ã–π</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="mb-3">
                                                        <label class="form-label text-light">–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞:</label>
                                                        <select class="form-control bg-dark border-secondary text-light" id="chartColorScheme">
                                                            <option value="gold">–ó–æ–ª–æ—Ç–∞—è</option>
                                                            <option value="blue">–°–∏–Ω—è—è</option>
                                                            <option value="green">–ó–µ–ª–µ–Ω–∞—è</option>
                                                            <option value="red">–ö—Ä–∞—Å–Ω–∞—è</option>
                                                            <option value="purple">–§–∏–æ–ª–µ—Ç–æ–≤–∞—è</option>
                                                            <option value="rainbow">–†–∞–¥—É–∂–Ω–∞—è</option>
                                                            <option value="monochrome">–ú–æ–Ω–æ—Ö—Ä–æ–º</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label class="form-label text-light">–í—Ä–µ–º–µ–Ω–Ω–æ–π —à–∞–≥:</label>
                                                        <select class="form-control bg-dark border-secondary text-light" id="timeStepSelect">
                                                            <option value="hour">1 —á–∞—Å</option>
                                                            <option value="3hours">3 —á–∞—Å–∞</option>
                                                            <option value="6hours">6 —á–∞—Å–æ–≤</option>
                                                            <option value="9hours">9 —á–∞—Å–æ–≤</option>
                                                            <option value="12hours">12 —á–∞—Å–æ–≤</option>
                                                            <option value="day" selected>–î–µ–Ω—å</option>
                                                            <option value="3days">3 –¥–Ω—è</option>
                                                            <option value="week">–ù–µ–¥–µ–ª—è</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label class="form-label text-light">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞:</label>
                                                        <select class="form-control bg-dark border-secondary text-light" id="chartParamsSelect" multiple>
                                                            <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                                                        </select>
                                                        <small class="text-muted">–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ Ctrl –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-12 text-end">
                                                    <button class="btn btn-gold" onclick="analyzer.createChart()">
                                                        <i class="fas fa-chart-line me-2"></i>–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫
                                                    </button>
                                                    <button class="btn btn-outline-gold ms-2" onclick="analyzer.resetChartSettings()">
                                                        <i class="fas fa-redo me-2"></i>–°–±—Ä–æ—Å–∏—Ç—å
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –ì—Ä–∞—Ñ–∏–∫ -->
                            <div class="row mb-4">
                                <div class="col-md-12">
                                    <div class="card bg-dark border-secondary">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">–ì—Ä–∞—Ñ–∏–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</h5>
                                            <div class="btn-group">
                                                <button class="btn btn-sm btn-outline-gold" onclick="analyzer.exportChart('png')">
                                                    <i class="fas fa-image me-1"></i>PNG
                                                </button>
                                                <button class="btn btn-sm btn-outline-gold" onclick="analyzer.exportChart('jpg')">
                                                    <i class="fas fa-file-image me-1"></i>JPG
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container" id="mainChartContainer">
                                                <canvas id="mainChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –¢–∞–±–ª–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö -->
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card bg-dark border-secondary">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">–¢–∞–±–ª–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö</h5>
                                            <div class="btn-group">
                                                <button class="btn btn-sm btn-outline-gold" onclick="analyzer.exportTableData('csv')">
                                                    <i class="fas fa-file-csv me-1"></i>CSV
                                                </button>
                                                <button class="btn btn-sm btn-outline-gold" onclick="analyzer.exportTableData('excel')">
                                                    <i class="fas fa-file-excel me-1"></i>Excel
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body p-0">
                                            <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
                                                <table class="table table-dark table-hover mb-0">
                                                    <thead style="position: sticky; top: 0; background: #1a1a1a;">
                                                        <tr>
                                                            <th>#</th>
                                                            <th>–¢–°</th>
                                                            <th>–í—Ä–µ–º—è</th>
                                                            <th>–°—Ç–∞–¥–∏—è</th>
                                                            <th>–ü—Ä–æ–±–µ–≥ (–∫–º)</th>
                                                            <th>–†–∞—Å—Ö–æ–¥ (–ª)</th>
                                                            <th>–°–∫–æ—Ä–æ—Å—Ç—å (–∫–º/—á)</th>
                                                            <th>–†–µ–π—Ç–∏–Ω–≥ (%)</th>
                                                            <th>–ú–æ—Ç–æ—á–∞—Å—ã (—á)</th>
                                                            <th>–î–µ—Ç–∞–ª–∏</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="rawDataTableBody">
                                                        <tr>
                                                            <td colspan="10" class="text-center py-4">
                                                                <i class="fas fa-database fa-2x text-muted mb-3"></i>
                                                                <p class="text-muted mb-0">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π –∑–∞–ø–∏—Å–∏ -->
<div class="modal fade" id="recordDetailsModal">
    <div class="modal-dialog modal-xl">
        <div class="modal-content bg-dark">
            <div class="modal-header border-secondary">
                <h5 class="modal-title text-gold">–î–µ—Ç–∞–ª–∏ –∑–∞–ø–∏—Å–∏</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h6>
                        <table class="table table-sm table-dark" id="basicInfoTable">
                            <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JS -->
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6>–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h6>
                        <div class="params-details-container" id="paramsDetailsContainer">
                            <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –û–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
        <div class="loading-spinner"></div>
        <h4 id="loadingTitle" class="mt-4 mb-2 text-gold">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h4>
        <p id="loadingMessage" class="text-light opacity-75 mb-0">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</p>
        <div class="progress mt-3" style="width: 300px;">
            <div class="progress-bar bg-gold" id="loadingProgress" style="width: 0%"></div>
        </div>
    </div>
</div>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
<div id="notificationContainer" class="notification-container"></div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ============================================
// VehicleAnalyzer - –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¢–°
// ============================================
class VehicleAnalyzer {
    constructor() {
        this.vehicles = [];
        this.filteredVehicles = [];
        this.selectedVehicles = [];
        this.rawData = null;
        this.chart = null;
        this.currentChartData = null;

        // –¶–≤–µ—Ç–æ–≤—ã–µ —Å—Ö–µ–º—ã
        this.colorSchemes = {
            gold: [
                '#FFD700', '#FFED4E', '#D4AF37', '#B8860B', '#FFA500',
                '#F0C420', '#E6B800', '#CFB53B', '#C5B358', '#B29700'
            ],
            blue: [
                '#3498db', '#2980b9', '#1f6394', '#15486f', '#0a2d4a',
                '#5dade2', '#2e86c1', '#1b4f72', '#0e3a5c', '#082947'
            ],
            green: [
                '#2ecc71', '#27ae60', '#1e8449', '#145a32', '#0a301b',
                '#52be80', '#229954', '#196f3d', '#0e4d2a', '#073018'
            ],
            red: [
                '#e74c3c', '#c0392b', '#a93226', '#7b241c', '#4d160f',
                '#ec7063', '#cb4335', '#a93226', '#78281f', '#4a1c13'
            ],
            purple: [
                '#9b59b6', '#8e44ad', '#7d3c98', '#6c3483', '#5b2c6f',
                '#af7ac5', '#9b59b6', '#884ea0', '#76448a', '#633974'
            ],
            rainbow: [
                '#FF0000', '#FF7F00', '#FFFF00', '#00FF00', '#0000FF',
                '#4B0082', '#8B00FF', '#FF1493', '#00CED1', '#32CD32'
            ],
            monochrome: [
                '#FFFFFF', '#CCCCCC', '#999999', '#666666', '#333333',
                '#E6E6E6', '#B3B3B3', '#808080', '#4D4D4D', '#1A1A1A'
            ]
        };
    }

    // ============================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    // ============================================
    async init() {
        console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –¢–°');

        try {
            await this.loadVehicles();
            this.setupEventListeners();
            this.showNotification('–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ', 'info');

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            this.showNotification('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + error.message, 'error');
        }
    }

    // ============================================
    // –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–•
    // ============================================
    async loadVehicles() {
        this.showLoading('–ó–∞–≥—Ä—É–∑–∫–∞ –¢–°', '–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤...');

        try {
            const response = await fetch('/vehicles/api/get-vehicles/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': this.getCsrfToken()
                }
            });

            if (!response.ok) {
                throw new Error(`HTTP –æ—à–∏–±–∫–∞ ${response.status}`);
            }

            const data = await response.json();

            if (data.success) {
                this.vehicles = data.data.vehicles || [];
                this.filteredVehicles = [...this.vehicles];
                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –¢–°: ${this.vehicles.length}`);
                this.renderVehiclesList();
                this.showNotification(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${this.vehicles.length} –¢–°`, 'success');
            } else {
                throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¢–°');
            }

        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¢–°:', error);
            this.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¢–°: ' + error.message, 'error');

        } finally {
            this.hideLoading();
        }
    }

    async loadData() {
        if (this.selectedVehicles.length === 0) {
            this.showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –¢–°', 'warning');
            return;
        }

        const startDate = document.getElementById('dateFrom').value;
        const endDate = document.getElementById('dateTo').value;

        if (!startDate || !endDate) {
            this.showNotification('–£–∫–∞–∂–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞', 'warning');
            return;
        }

        try {
            this.showLoading('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö', '–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ AutoGRAPH...');
            this.updateProgress(30, '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...');

            const response = await fetch('/vehicles/api/get-raw-data-table/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': this.getCsrfToken()
                },
                body: JSON.stringify({
                    vehicle_ids: this.selectedVehicles,
                    start_date: startDate,
                    end_date: endDate
                })
            });

            this.updateProgress(60, '–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');

            if (!response.ok) {
                throw new Error(`HTTP –æ—à–∏–±–∫–∞: ${response.status}`);
            }

            const data = await response.json();
            this.updateProgress(90, '–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...');

            if (data.success) {
                this.rawData = data.data;
                this.renderData();
                this.showNotification(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.data.summary?.total_records || 0} –∑–∞–ø–∏—Å–µ–π`, 'success');

            } else {
                throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            }

        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
            this.showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
        } finally {
            this.updateProgress(100, '–ó–∞–≤–µ—Ä—à–µ–Ω–æ');
            setTimeout(() => this.hideLoading(), 1000);
        }
    }

    // ============================================
    // –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –î–ê–ù–ù–´–•
    // ============================================
    renderData() {
        if (!this.rawData) return;

        const summary = this.rawData.summary || {};
        const tableData = this.rawData.table_data || {};
        const paramGroups = this.rawData.parameter_groups || {};

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        this.updateStatistics(summary);

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        this.updateMainInfo();

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—ã–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        this.populateChartParams(paramGroups);

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–≤–æ–≥–æ –¢–°
        if (tableData.vehicles && Object.keys(tableData.vehicles).length > 0) {
            const firstVehicleId = Object.keys(tableData.vehicles)[0];
            this.renderVehicleTableData(firstVehicleId);
        }
    }

    updateStatistics(summary) {
        const recordsEl = document.getElementById('statsRecords');
        const paramsEl = document.getElementById('statsParams');
        const vehiclesEl = document.getElementById('statsVehicles');
        const periodEl = document.getElementById('statsPeriod');

        if (recordsEl) recordsEl.textContent = (summary.total_records || 0).toLocaleString('ru-RU');
        if (paramsEl) paramsEl.textContent = summary.total_parameters || 0;
        if (vehiclesEl) vehiclesEl.textContent = summary.vehicle_count || 0;
        if (periodEl) periodEl.textContent = summary.period?.start ?
            `${summary.period.start} - ${summary.period.end}` : '‚Äî';
    }

    updateMainInfo() {
        if (!this.rawData || !this.rawData.table_data?.vehicles) return;

        let totalDistance = 0;
        let totalFuel = 0;
        let totalSpeed = 0;
        let totalRating = 0;
        let count = 0;

        Object.values(this.rawData.table_data.vehicles).forEach(vehicleData => {
            (vehicleData.samples || []).forEach(item => {
                const distance = this.getNumericValue(item.Values, ['TotalDistance', 'Distance', 'Odometer']);
                const fuel = this.getNumericValue(item.Values, ['Engine1FuelConsum', 'FuelConsumption', 'Fuel']);
                const speed = this.getNumericValue(item.Values, ['Speed', 'AverageSpeed', 'MaxSpeed']);
                const rating = this.getNumericValue(item.Values, ['DQRating', 'Rating']);

                if (distance !== null) totalDistance += distance;
                if (fuel !== null) totalFuel += fuel;
                if (speed !== null) {
                    totalSpeed += speed;
                    count++;
                }
                if (rating !== null) totalRating += rating;
            });
        });

        const distanceEl = document.getElementById('rawDataDistance');
        const fuelEl = document.getElementById('rawDataFuel');
        const speedEl = document.getElementById('rawDataSpeed');
        const ratingEl = document.getElementById('rawDataRating');

        if (distanceEl) distanceEl.textContent = this.formatNumber(totalDistance, 1);
        if (fuelEl) fuelEl.textContent = this.formatNumber(totalFuel, 1);
        if (speedEl) speedEl.textContent = count > 0 ? this.formatNumber(totalSpeed / count, 1) : '0';
        if (ratingEl) ratingEl.textContent = count > 0 ? this.formatNumber(totalRating / count, 1) : '0';
    }

    populateChartParams(paramGroups) {
        const select = document.getElementById('chartParamsSelect');
        if (!select) return;

        let html = '';

        for (const [groupId, groupData] of Object.entries(paramGroups)) {
            (groupData.params || []).forEach(param => {
                html += `<option value="${param.api_name || param.id}">${groupData.name}: ${param.display_name || param.name}</option>`;
            });
        }

        select.innerHTML = html;
    }

    renderVehicleTableData(vehicleId = null) {
        if (!vehicleId) return;

        if (!this.rawData || !this.rawData.table_data?.vehicles?.[vehicleId]) {
            return;
        }

        const vehicleData = this.rawData.table_data.vehicles[vehicleId];

        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É
        const tbody = document.getElementById('rawDataTableBody');
        if (!tbody) return;

        if (!vehicleData.samples || vehicleData.samples.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="10" class="text-center py-4">
                        <i class="fas fa-database fa-2x text-muted mb-3"></i>
                        <p class="text-muted mb-0">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                    </td>
                </tr>
            `;
            return;
        }

        let html = '';

        vehicleData.samples.forEach((item, index) => {
            const speed = this.getParamValue(item.Values, ['Speed', 'AverageSpeed', 'MaxSpeed']);
            const fuel = this.getParamValue(item.Values, ['Engine1FuelConsum', 'FuelConsumption', 'Fuel']);
            const distance = this.getParamValue(item.Values, ['TotalDistance', 'Distance', 'Odometer']);
            const rating = this.getParamValue(item.Values, ['DQRating', 'Rating']);
            const hours = this.getParamValue(item.Values, ['Engine1Motohours', 'TotalDuration', 'MoveDuration']);

            html += `
                <tr>
                    <td>${index + 1}</td>
                    <td>${vehicleData.name}</td>
                    <td>${this.formatDateTime(item.DT)}</td>
                    <td><span class="badge bg-secondary">${item.Stage || '‚Äî'}</span></td>
                    <td>${distance}</td>
                    <td>${fuel}</td>
                    <td>${speed}</td>
                    <td>${rating}</td>
                    <td>${hours}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-gold"
                                onclick="analyzer.showRecordDetails('${vehicleId}', ${index})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `;
        });

        tbody.innerHTML = html;
    }

    // ============================================
    // –ì–†–ê–§–ò–ö–ò
    // ============================================
    createChart() {
        if (!this.rawData) {
            this.showNotification('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ', 'warning');
            return;
        }

        const paramsSelect = document.getElementById('chartParamsSelect');
        if (!paramsSelect) return;

        const selectedParams = Array.from(paramsSelect.selectedOptions)
            .map(opt => opt.value);

        if (selectedParams.length === 0) {
            this.showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞', 'warning');
            return;
        }

        const chartType = document.getElementById('chartTypeSelect').value;
        const chartSize = document.getElementById('chartSizeSelect').value;
        const colorScheme = document.getElementById('chartColorScheme').value;
        const timeStep = document.getElementById('timeStepSelect').value;

        // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
        const chartData = this.prepareChartData(selectedParams, timeStep);

        if (!chartData || chartData.labels.length === 0) {
            this.showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞', 'warning');
            return;
        }

        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
        this.setChartSize(chartSize);

        // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
        this.renderChart(chartType, chartData, colorScheme);
    }

    prepareChartData(params, timeStep) {
        if (!this.rawData || !this.rawData.table_data?.vehicles) return null;

        const vehicles = this.rawData.table_data.vehicles;
        const chartData = {
            labels: [],
            datasets: []
        };

        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
        const allTimes = new Set();
        Object.values(vehicles).forEach(vehicleData => {
            (vehicleData.samples || []).forEach(item => {
                if (item.DT) {
                    const timeGroup = this.groupTimeByStep(item.DT, timeStep);
                    allTimes.add(timeGroup);
                }
            });
        });

        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
        chartData.labels = Array.from(allTimes).sort();

        // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —Å–æ–∑–¥–∞–µ–º –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
        params.forEach((param, paramIndex) => {
            const paramData = this.prepareParamData(param, chartData.labels, timeStep);

            if (paramData && paramData.length > 0) {
                const colors = this.getColorScheme(paramIndex);

                chartData.datasets.push({
                    label: param,
                    data: paramData,
                    backgroundColor: this.getBackgroundColor(chartData.labels.length, colors.primary),
                    borderColor: colors.border,
                    borderWidth: 2,
                    fill: document.getElementById('chartTypeSelect').value === 'area',
                    tension: 0.3
                });
            }
        });

        return chartData;
    }

    prepareParamData(param, labels, timeStep) {
        if (!this.rawData || !this.rawData.table_data?.vehicles) return [];

        const vehicles = this.rawData.table_data.vehicles;
        const paramData = new Array(labels.length).fill(0);
        const counts = new Array(labels.length).fill(0);

        Object.values(vehicles).forEach(vehicleData => {
            (vehicleData.samples || []).forEach(item => {
                if (item.Values && item.Values[param] !== undefined && item.DT) {
                    const timeGroup = this.groupTimeByStep(item.DT, timeStep);
                    const index = labels.indexOf(timeGroup);

                    if (index !== -1) {
                        const value = parseFloat(item.Values[param]);
                        if (!isNaN(value)) {
                            paramData[index] += value;
                            counts[index]++;
                        }
                    }
                }
            });
        });

        // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
        return paramData.map((sum, i) => counts[i] > 0 ? sum / counts[i] : 0);
    }

    groupTimeByStep(dt, step) {
        if (!dt) return '';

        try {
            const date = new Date(dt);

            switch(step) {
                case 'hour':
                    return date.toISOString().slice(0, 13) + ':00';
                case '3hours':
                    const hour3 = Math.floor(date.getHours() / 3) * 3;
                    return `${date.toISOString().slice(0, 10)} ${hour3.toString().padStart(2, '0')}:00`;
                case '6hours':
                    const hour6 = Math.floor(date.getHours() / 6) * 6;
                    return `${date.toISOString().slice(0, 10)} ${hour6.toString().padStart(2, '0')}:00`;
                case '9hours':
                    const hour9 = Math.floor(date.getHours() / 9) * 9;
                    return `${date.toISOString().slice(0, 10)} ${hour9.toString().padStart(2, '0')}:00`;
                case '12hours':
                    const hour12 = Math.floor(date.getHours() / 12) * 12;
                    return `${date.toISOString().slice(0, 10)} ${hour12.toString().padStart(2, '0')}:00`;
                case 'day':
                    return date.toISOString().slice(0, 10);
                case '3days':
                    const day3 = Math.floor(date.getDate() / 3) * 3;
                    return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${day3.toString().padStart(2, '0')}`;
                case 'week':
                    const weekStart = new Date(date);
                    weekStart.setDate(date.getDate() - date.getDay());
                    return weekStart.toISOString().slice(0, 10);
                default:
                    return date.toISOString().slice(0, 10);
            }
        } catch (e) {
            return dt.slice(0, 10); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—ã–µ 10 —Å–∏–º–≤–æ–ª–æ–≤ –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å
        }
    }

    setChartSize(size) {
        const container = document.getElementById('mainChartContainer');
        if (!container) return;

        switch(size) {
            case 'small':
                container.style.height = '300px';
                break;
            case 'medium':
                container.style.height = '400px';
                break;
            case 'large':
                container.style.height = '500px';
                break;
            case 'full':
                container.style.height = '600px';
                break;
        }
    }

    getColorScheme(index) {
        const schemeName = document.getElementById('chartColorScheme')?.value || 'gold';
        const scheme = this.colorSchemes[schemeName] || this.colorSchemes.gold;

        const colorIndex = index % scheme.length;
        return {
            primary: scheme[colorIndex],
            border: scheme[colorIndex]
        };
    }

    getBackgroundColor(count, baseColor) {
        const chartType = document.getElementById('chartTypeSelect')?.value || 'line';

        if (chartType === 'pie' || chartType === 'doughnut') {
            // –î–ª—è –∫—Ä—É–≥–æ–≤—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º –Ω—É–∂–Ω—ã —Ä–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
            const schemeName = document.getElementById('chartColorScheme')?.value || 'gold';
            const scheme = this.colorSchemes[schemeName] || this.colorSchemes.gold;

            const colors = [];
            for (let i = 0; i < count; i++) {
                colors.push(scheme[i % scheme.length]);
            }
            return colors;
        } else {
            // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ - –æ–¥–∏–Ω —Ü–≤–µ—Ç —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é
            return baseColor + '40'; // 25% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
        }
    }

    renderChart(type, data, colorScheme) {
        const canvas = document.getElementById('mainChart');
        if (!canvas) return;

        const ctx = canvas.getContext('2d');

        // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫
        if (this.chart) {
            this.chart.destroy();
        }

        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞
        let chartType = type;
        if (type === 'barHorizontal') {
            chartType = 'bar';
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤
        const options = this.getChartOptions(type, colorScheme);

        // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
        try {
            this.chart = new Chart(ctx, {
                type: chartType,
                data: data,
                options: options
            });

            this.currentChartData = { type, data, colorScheme };
            this.showNotification('–ì—Ä–∞—Ñ–∏–∫ –ø–æ—Å—Ç—Ä–æ–µ–Ω', 'success');
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞:', error);
            this.showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞: ' + error.message, 'error');
        }
    }

    getChartOptions(type, colorScheme) {
        const isHorizontal = type === 'barHorizontal';
        const isCircular = type === 'pie' || type === 'doughnut';
        const isRadar = type === 'radar';

        const baseOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: '–ê–Ω–∞–ª–∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¢–°',
                    color: '#FFD700',
                    font: { size: 16, weight: 'bold' }
                },
                legend: {
                    labels: {
                        color: '#FFFFFF',
                        font: { size: 12 }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    titleColor: '#FFD700',
                    bodyColor: '#FFFFFF',
                    borderColor: '#FFD700',
                    borderWidth: 1
                }
            }
        };

        if (isCircular || isRadar) {
            return baseOptions;
        }

        return {
            ...baseOptions,
            scales: {
                x: {
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    ticks: { color: '#CCCCCC' },
                    title: {
                        display: isHorizontal,
                        text: '–ó–Ω–∞—á–µ–Ω–∏–µ',
                        color: '#CCCCCC'
                    }
                },
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    ticks: { color: '#CCCCCC' },
                    title: {
                        display: !isHorizontal,
                        text: '–ó–Ω–∞—á–µ–Ω–∏–µ',
                        color: '#CCCCCC'
                    }
                }
            }
        };
    }

    resetChartSettings() {
        document.getElementById('chartTypeSelect').value = 'line';
        document.getElementById('chartSizeSelect').value = 'medium';
        document.getElementById('chartColorScheme').value = 'gold';
        document.getElementById('timeStepSelect').value = 'day';

        const paramsSelect = document.getElementById('chartParamsSelect');
        if (paramsSelect) {
            Array.from(paramsSelect.options).forEach(option => {
                option.selected = false;
            });
        }

        if (this.chart) {
            this.chart.destroy();
            this.chart = null;
        }

        this.showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞ —Å–±—Ä–æ—à–µ–Ω—ã', 'info');
    }

    exportChart(format) {
        if (!this.chart) {
            this.showNotification('–°–Ω–∞—á–∞–ª–∞ –ø–æ—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫', 'warning');
            return;
        }

        try {
            const link = document.createElement('a');
            link.download = `–≥—Ä–∞—Ñ–∏–∫-${new Date().toISOString().slice(0,10)}.${format}`;
            link.href = this.chart.toBase64Image();
            link.click();

            this.showNotification('–ì—Ä–∞—Ñ–∏–∫ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–∞:', error);
            this.showNotification('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–∞', 'error');
        }
    }

    // ============================================
    // –≠–ö–°–ü–û–†–¢ –î–ê–ù–ù–´–•
    // ============================================
    exportTableData(format) {
        if (!this.rawData) {
            this.showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'warning');
            return;
        }

        let data, filename, mimeType;

        if (format === 'csv') {
            data = this.convertToCSV();
            filename = `–¥–∞–Ω–Ω—ã–µ-—Ç—Å-${new Date().toISOString().slice(0,10)}.csv`;
            mimeType = 'text/csv;charset=utf-8;';
        } else if (format === 'excel') {
            data = this.convertToCSV();
            filename = `–¥–∞–Ω–Ω—ã–µ-—Ç—Å-${new Date().toISOString().slice(0,10)}.xls`;
            mimeType = 'application/vnd.ms-excel';
        } else {
            return;
        }

        try {
            const blob = new Blob([data], { type: mimeType });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();

            this.showNotification('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö:', error);
            this.showNotification('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö', 'error');
        }
    }

    convertToCSV() {
        if (!this.rawData || !this.rawData.table_data?.vehicles) return '';

        let csv = '–¢–°;–í—Ä–µ–º—è;–°—Ç–∞–¥–∏—è;–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å;';

        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        const allParams = new Set();
        Object.values(this.rawData.table_data.vehicles).forEach(vehicleData => {
            (vehicleData.samples || []).forEach(item => {
                if (item.Values) {
                    Object.keys(item.Values).forEach(param => {
                        allParams.add(param);
                    });
                }
            });
        });

        const paramsArray = Array.from(allParams);
        csv += paramsArray.join(';') + '\n';

        // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        Object.entries(this.rawData.table_data.vehicles).forEach(([vehicleId, vehicleData]) => {
            (vehicleData.samples || []).forEach(item => {
                const row = [
                    vehicleData.name || '',
                    `"${item.DT || ''}"`,
                    `"${item.Stage || ''}"`,
                    `"${item.Duration || ''}"`
                ];

                paramsArray.forEach(param => {
                    let value = item.Values?.[param] || '';
                    if (typeof value === 'string') {
                        value = value.replace(/"/g, '""');
                        if (value.includes(';') || value.includes('"')) {
                            value = `"${value}"`;
                        }
                    }
                    row.push(value);
                });

                csv += row.join(';') + '\n';
            });
        });

        return csv;
    }

    // ============================================
    // –î–ï–¢–ê–õ–ò –ó–ê–ü–ò–°–ò
    // ============================================
    showRecordDetails(vehicleId, itemIndex) {
        if (!this.rawData || !this.rawData.table_data?.vehicles?.[vehicleId]) {
            return;
        }

        const vehicleData = this.rawData.table_data.vehicles[vehicleId];
        const item = vehicleData.samples?.[itemIndex];

        if (!item) return;

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        const basicInfoTable = document.getElementById('basicInfoTable');
        if (basicInfoTable) {
            basicInfoTable.innerHTML = `
                <tr><td>–¢–°:</td><td class="text-gold">${vehicleData.name || ''}</td></tr>
                <tr><td>–í—Ä–µ–º—è:</td><td>${this.formatDateTime(item.DT)}</td></tr>
                <tr><td>–°—Ç–∞–¥–∏—è:</td><td>${item.Stage || '‚Äî'}</td></tr>
                <tr><td>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</td><td>${item.Duration || '‚Äî'}</td></tr>
                <tr><td>–ó–∞–≥–æ–ª–æ–≤–æ–∫:</td><td>${item.Caption || '‚Äî'}</td></tr>
            `;
        }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        const paramsContainer = document.getElementById('paramsDetailsContainer');
        if (paramsContainer) {
            let paramsHtml = '<div class="params-details-grid">';

            if (item.Values) {
                for (const [param, value] of Object.entries(item.Values)) {
                    const numValue = parseFloat(value);
                    const isNumeric = !isNaN(numValue);

                    paramsHtml += `
                        <div class="param-detail-item">
                            <div class="param-detail-header">
                                <div class="param-detail-name" title="${param}">${param}</div>
                            </div>
                            <div class="param-detail-value">
                                ${isNumeric ? this.formatNumber(numValue, 4) : value}
                            </div>
                        </div>
                    `;
                }
            }

            paramsHtml += '</div>';
            paramsContainer.innerHTML = paramsHtml;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const modalElement = document.getElementById('recordDetailsModal');
        if (modalElement) {
            const modal = new bootstrap.Modal(modalElement);
            modal.show();
        }
    }

    // ============================================
    // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –ú–ï–¢–û–î–´
    // ============================================
    renderVehiclesList() {
        const container = document.getElementById('vehiclesList');
        if (!container) return;

        if (this.filteredVehicles.length === 0) {
            container.innerHTML = `
                <div class="text-center py-4">
                    <i class="fas fa-car fa-2x text-muted mb-3"></i>
                    <p class="text-muted mb-0">–¢–° –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                </div>
            `;
            return;
        }

        let html = '';
        this.filteredVehicles.forEach(vehicle => {
            const isSelected = this.selectedVehicles.includes(vehicle.id);
            html += `
                <div class="vehicle-item ${isSelected ? 'selected' : ''}"
                     onclick="analyzer.toggleVehicle('${vehicle.id}')">
                    <div class="vehicle-icon">
                        <i class="fas fa-truck"></i>
                    </div>
                    <div class="vehicle-info">
                        <div class="vehicle-name">${vehicle.name}</div>
                        <div class="vehicle-plate">${vehicle.license_plate || '‚Äî'}</div>
                    </div>
                    <div class="vehicle-check">
                        <i class="fas fa-${isSelected ? 'check-circle' : 'circle'}"></i>
                    </div>
                </div>
            `;
        });

        container.innerHTML = html;
        this.updateVehicleCount();
        this.updateLoadButton();
    }

    searchVehicles(query) {
        if (!query) {
            this.filteredVehicles = [...this.vehicles];
        } else {
            const searchLower = query.toLowerCase();
            this.filteredVehicles = this.vehicles.filter(vehicle =>
                vehicle.name.toLowerCase().includes(searchLower) ||
                (vehicle.license_plate && vehicle.license_plate.toLowerCase().includes(searchLower))
            );
        }
        this.renderVehiclesList();
    }

    toggleVehicle(vehicleId) {
        const index = this.selectedVehicles.indexOf(vehicleId);
        if (index > -1) {
            this.selectedVehicles.splice(index, 1);
        } else {
            this.selectedVehicles.push(vehicleId);
        }
        this.renderVehiclesList();
    }

    selectAllVehicles() {
        this.selectedVehicles = this.filteredVehicles.map(v => v.id);
        this.renderVehiclesList();
        this.showNotification('–í—Å–µ –¢–° –≤—ã–±—Ä–∞–Ω—ã', 'success');
    }

    deselectAllVehicles() {
        this.selectedVehicles = [];
        this.renderVehiclesList();
        this.showNotification('–í—ã–±–æ—Ä –¢–° —Å–±—Ä–æ—à–µ–Ω', 'info');
    }

    setPeriod(days) {
        const toDate = new Date();
        const fromDate = new Date();
        fromDate.setDate(toDate.getDate() - days);

        document.getElementById('dateFrom').value = fromDate.toISOString().split('T')[0];
        document.getElementById('dateTo').value = toDate.toISOString().split('T')[0];
        this.updateLoadButton();
    }

    updateLoadButton() {
        const hasVehicles = this.selectedVehicles.length > 0;
        const dateFrom = document.getElementById('dateFrom');
        const dateTo = document.getElementById('dateTo');
        const hasDates = dateFrom?.value && dateTo?.value;
        const loadBtn = document.getElementById('loadDataBtn');

        if (loadBtn) {
            loadBtn.disabled = !hasVehicles || !hasDates;
        }
    }

    updateVehicleCount() {
        const selectedCount = document.getElementById('selectedCount');
        if (selectedCount) {
            selectedCount.textContent = this.selectedVehicles.length;
        }
    }

    getParamValue(values, paramNames) {
        if (!values) return '‚Äî';

        for (const paramName of paramNames) {
            if (values[paramName] !== undefined) {
                const value = values[paramName];
                const numValue = parseFloat(value);
                return !isNaN(numValue) ? this.formatNumber(numValue, 2) : value;
            }
        }
        return '‚Äî';
    }

    getNumericValue(values, paramNames) {
        if (!values) return null;

        for (const paramName of paramNames) {
            if (values[paramName] !== undefined) {
                const numValue = parseFloat(values[paramName]);
                return !isNaN(numValue) ? numValue : null;
            }
        }
        return null;
    }

    formatDateTime(dt) {
        if (!dt) return '‚Äî';
        try {
            if (dt.includes('T')) {
                const [date, time] = dt.split('T');
                const [year, month, day] = date.split('-');
                return `${day}.${month}.${year} ${time.substring(0, 8)}`;
            }
            return dt;
        } catch {
            return dt;
        }
    }

    formatNumber(value, decimals = 0) {
        if (value === null || value === undefined || isNaN(value)) {
            return '0';
        }

        return value.toLocaleString('ru-RU', {
            minimumFractionDigits: decimals,
            maximumFractionDigits: decimals
        });
    }

    setupEventListeners() {
        // –î–∞—Ç—ã
        const dateFrom = document.getElementById('dateFrom');
        const dateTo = document.getElementById('dateTo');

        if (dateFrom) dateFrom.addEventListener('change', () => this.updateLoadButton());
        if (dateTo) dateTo.addEventListener('change', () => this.updateLoadButton());

        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                this.loadData();
            }
        });
    }

    showLoading(title, message) {
        const overlay = document.getElementById('loadingOverlay');
        if (overlay) {
            const titleEl = document.getElementById('loadingTitle');
            const messageEl = document.getElementById('loadingMessage');

            if (titleEl) titleEl.textContent = title;
            if (messageEl) messageEl.textContent = message;
            overlay.style.display = 'flex';
        }
    }

    hideLoading() {
        const overlay = document.getElementById('loadingOverlay');
        if (overlay) {
            overlay.style.display = 'none';
        }
    }

    updateProgress(percent, message = '') {
        const progress = document.getElementById('loadingProgress');
        if (progress) {
            progress.style.width = percent + '%';
        }

        if (message) {
            const messageEl = document.getElementById('loadingMessage');
            if (messageEl) messageEl.textContent = message;
        }
    }

    showNotification(message, type = 'info') {
        const container = document.getElementById('notificationContainer');
        if (!container) return;

        const icon = {
            success: 'fa-check-circle',
            error: 'fa-times-circle',
            warning: 'fa-exclamation-triangle',
            info: 'fa-info-circle'
        }[type];

        const alertClass = {
            success: 'alert-success',
            error: 'alert-danger',
            warning: 'alert-warning',
            info: 'alert-info'
        }[type];

        const notification = document.createElement('div');
        notification.className = `alert ${alertClass} alert-dismissible fade show`;
        notification.innerHTML = `
            <i class="fas ${icon} me-2"></i>
            <span>${message}</span>
            <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
        `;

        container.appendChild(notification);

        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 5000);
    }

    getCsrfToken() {
        const token = document.querySelector('[name=csrfmiddlewaretoken]');
        return token ? token.value : '';
    }
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
const analyzer = new VehicleAnalyzer();

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
    analyzer.init();
});
</script>

<style>
/* ============================================
   –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò
   ============================================ */

.vehicles-container {
    padding-bottom: 2rem;
}

/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å */
.info-panel {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05));
    border: 1px solid rgba(255, 215, 0, 0.3);
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: flex-start;
}

.info-panel.info-small {
    padding: 0.75rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.info-panel.info-small .info-content {
    width: 100%;
}

.info-icon {
    color: var(--primary-gold);
    font-size: 1.2rem;
    margin-right: 1rem;
    margin-top: 0.2rem;
}

.info-content {
    color: var(--text-light);
    font-size: 0.9rem;
    flex: 1;
}

/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
.stats-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.stats-item:last-child {
    border-bottom: none;
}

.stats-label {
    color: #CCCCCC;
    font-size: 0.85rem;
}

.stats-value {
    color: #FFD700;
    font-weight: 600;
    font-size: 1rem;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ */
.chart-container {
    height: 400px;
    position: relative;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    padding: 1rem;
}

/* –î–µ—Ç–∞–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ */
.params-details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 0.75rem;
    max-height: 400px;
    overflow-y: auto;
    padding: 0.5rem;
}

.param-detail-item {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    padding: 0.75rem;
}

.param-detail-header {
    margin-bottom: 0.5rem;
}

.param-detail-name {
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 0.8rem;
    color: #888888;
    word-break: break-all;
}

.param-detail-value {
    font-size: 0.9rem;
    color: #FFD700;
    font-weight: 500;
    font-family: 'Consolas', 'Monaco', monospace;
}

/* –¢–∞–±–ª–∏—Ü–∞ */
.table-responsive {
    border-radius: 8px;
}

.table-dark {
    margin-bottom: 0;
}

.table-dark th {
    background: rgba(255, 215, 0, 0.1);
    color: #FFD700;
    border-color: rgba(255, 255, 255, 0.1);
    font-weight: 600;
    font-size: 0.85rem;
    padding: 0.75rem 1rem;
    position: sticky;
    top: 0;
}

.table-dark td {
    border-color: rgba(255, 255, 255, 0.05);
    padding: 0.75rem 1rem;
    vertical-align: middle;
    font-size: 0.9rem;
}

.table-dark tbody tr:hover {
    background: rgba(255, 215, 0, 0.05);
}

/* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ */
.card.bg-dark {
    background: rgba(255, 255, 255, 0.03) !important;
}

.card-header {
    background: rgba(0, 0, 0, 0.2);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.card-body {
    padding: 1.5rem;
}

/* –§–æ—Ä–º—ã */
.form-control.bg-dark {
    background: rgba(0, 0, 0, 0.3) !important;
    border-color: rgba(255, 255, 255, 0.2);
    color: #FFFFFF;
}

.form-control.bg-dark:focus {
    background: rgba(0, 0, 0, 0.5);
    border-color: #FFD700;
    color: #FFFFFF;
    box-shadow: 0 0 0 0.25rem rgba(255, 215, 0, 0.25);
}

.form-label {
    color: #CCCCCC;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

/* –ö–Ω–æ–ø–∫–∏ */
.btn-gold {
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    border: none;
    color: #000000;
    font-weight: 600;
    padding: 0.5rem 1.5rem;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.btn-gold:hover {
    background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
    color: #000000;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
}

.btn-outline-gold {
    border: 2px solid #FFD700;
    color: #FFD700;
    background: transparent;
    font-weight: 600;
    padding: 0.5rem 1.5rem;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.btn-outline-gold:hover {
    background: rgba(255, 215, 0, 0.1);
    color: #FFD700;
    transform: translateY(-2px);
}

.btn-dark-custom {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #CCCCCC;
    transition: all 0.3s ease;
}

.btn-dark-custom:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 215, 0, 0.3);
    color: #FFFFFF;
}

/* –°–ø–∏—Å–æ–∫ –¢–° */
.vehicles-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.vehicle-item {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 0.75rem;
    display: flex;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.vehicle-item:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.2);
}

.vehicle-item.selected {
    background: rgba(255, 215, 0, 0.1);
    border-color: rgba(255, 215, 0, 0.3);
}

.vehicle-icon {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    background: rgba(255, 215, 0, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 0.75rem;
    color: #FFD700;
}

.vehicle-info {
    flex: 1;
}

.vehicle-name {
    color: #FFFFFF;
    font-weight: 500;
    font-size: 0.95rem;
    margin-bottom: 0.1rem;
}

.vehicle-plate {
    color: #888888;
    font-size: 0.8rem;
}

.vehicle-check {
    color: rgba(255, 255, 255, 0.3);
    font-size: 1.1rem;
}

.vehicle-item.selected .vehicle-check {
    color: #FFD700;
}

/* –û–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    z-index: 9999;
    display: none;
    justify-content: center;
    align-items: center;
}

.loading-content {
    text-align: center;
    background: rgba(255, 255, 255, 0.05);
    padding: 2rem;
    border-radius: 12px;
    border: 1px solid rgba(255, 215, 0, 0.3);
}

.loading-spinner {
    width: 60px;
    height: 60px;
    border: 4px solid rgba(255, 215, 0, 0.3);
    border-top: 4px solid #FFD700;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
.notification-container {
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 9998;
    max-width: 350px;
}

.notification-container .alert {
    margin-bottom: 0.5rem;
    animation: slideInRight 0.3s ease;
}

@keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

/* –í–∫–ª–∞–¥–∫–∏ */
.tabs-container {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    overflow: hidden;
}

.tabs-header {
    display: flex;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding: 0.5rem;
}

.tab-btn {
    background: transparent;
    border: none;
    color: #CCCCCC;
    padding: 0.75rem 1.5rem;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border-radius: 8px;
    margin: 0 0.25rem;
}

.tab-btn:hover {
    background: rgba(255, 255, 255, 0.05);
    color: #FFFFFF;
}

.tab-btn.active {
    background: rgba(255, 215, 0, 0.1);
    color: #FFD700;
    border-bottom: 2px solid #FFD700;
}

.tab-content {
    display: none;
    padding: 1.5rem;
}

.tab-content.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
.control-panel {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    overflow: hidden;
}

.panel-header {
    background: rgba(0, 0, 0, 0.3);
    padding: 1rem 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.panel-title {
    color: #FFD700;
    font-weight: 600;
    font-size: 1rem;
    margin: 0;
    display: flex;
    align-items: center;
}

.panel-title i {
    margin-right: 0.5rem;
}

.panel-body {
    padding: 1.5rem;
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
.modal-content {
    border: 2px solid #FFD700;
    border-radius: 12px;
}

.modal-header {
    background: rgba(0, 0, 0, 0.5);
    border-bottom: 1px solid rgba(255, 215, 0, 0.3);
}

.modal-title {
    color: #FFD700;
    font-weight: 600;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .params-details-grid {
        grid-template-columns: 1fr;
    }

    .tab-btn {
        flex: 1;
        min-width: 120px;
        margin: 0.25rem;
        padding: 0.5rem 1rem;
        font-size: 0.85rem;
    }

    .vehicle-name {
        font-size: 0.85rem;
    }

    .vehicle-plate {
        font-size: 0.75rem;
    }

    .chart-container {
        height: 300px;
        padding: 0.5rem;
    }
}

@media (max-width: 576px) {
    .chart-container {
        height: 250px;
    }

    .stats-item {
        flex-direction: column;
        align-items: flex-start;
    }

    .stats-value {
        margin-top: 0.25rem;
    }
}
</style>
{% endblock %}